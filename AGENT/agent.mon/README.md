# 监控AGENT版本说明

```
版本2:
    解决进程采集太耗CPU的问题。

版本3:
    进程监控匹配方式改成“包含”字符。
    修改了进程启动时间的获取方式。
    进程监控指标node_process_time改成node_process_etime。
    端口监控状态区分端口是否是开放的。
版本4:
    没有监控项时跳过进程和端口监控。
版本5:
    没有安装sar或者ss命令时，返回采集状态3。
版本6:
    进程监控和端口监控添加app字段。
版本7:
    处理HTTP协议，确保大的携带数据能正确匹配，避免过早关闭连接。
版本8:
    兼容只安装普罗米修斯node exporter的情况，本程序只作为代理。
版本9:
    端口和进程监控，名称支持下划线和减号。
版本10:
    添加文件、目录、软链接监控功能。
版本11:
   sar 监控去掉下面两个指标，有的机器没有gnice指标。
   node_cpu_gnice_percent_summary
   node_cpu_gnice_percent
版本12:
   url 监控支持指定Host头
版本13:
   执行命令时，通过AnyEvent从管道中实时获取数据，避免堵塞导致插件超时。
版本14:
   修复上一个版本已入的bug，不要提前退出。
版本15:
   磁盘监控命令df添加-P参数，增强可移植性。
   有的情况下df的输出为了展示美观进行了换行，这样会导致匹配内容错误，添加-P参数后避免该情况。
版本16:
   磁盘监控，去掉-l参数，网络盘也进行监控【如：nfs盘】
版本17:
   debug时显示后端url信息。
版本18:
   修复13版本引入的异常，导致CPU使用率高。【13-17版本的要升级到该版本】。
版本19:
   NodeExporter 在作为代理的时候，扩展了nodeext（外部数据）采集，代理需要更新才能识别外部数据采集的URL。
   否则可能返回的是代理节点的metrics数据(外部采集的uri刚好包含 /metrics的情况下)。或者采集不到数据。
版本20:
   进程监控添加了debug日志，方便定位在报进程重启时无法找到当时匹配到的进程。
版本21:
   进程监控支持字符":", 有的进程名会包含有冒号，如: "nginx: master process nginx"
版本22:
   主机如果已经安装了node_exporter，并且监听在一个具体的ip上，监控agent会尝试找到这个ip。
   避免已经安装了node_exporter的情况下采集不到原生的node_exporter数据。
版本23:
   采集agent中的公钥列表，用于后续公钥定期替换。
版本24:
   HTTP监控，post请求，支持配置简单的数据post到接口中.
   HTTP监控返回内容匹配，匹配的内容可能有特殊的字符，支持通过base64进行编码
版本25:
   为了兼容普罗米修斯的格式，把通过push上来的数据指标名中的“.”和“-“字符修改成“_”,
   通过Content-Length字段来判定http数据完整，有的push请求，一次push上来很多数据，一次读取不完，需要等待Content-Length长度，
   否则因为数据不全时把数据转换成json失败，导致push失败，最终数据没有上传到普罗米修斯中。
版本26:
   采集FalconMigrate(falcon兼容程序)的状态数据，包括版本、错误数量等。
   处理Http插件body为空时日志中的警告。
版本27:
   bootstrap中没有falcon_migrate的启动文件的情况下，不请求1988端口采集数据，直接返回-1。避免无效的http请求。
版本28:
   添加统计指标，统计通过push方式上传的数据数量和错误数量。
```

node_collector_error 错误码

```
-2: 无监控项，采集跳过
-1: 启动中
0: 正常
1: 错误
2: 超时
3: 依赖工具缺失
```

监控agent的版本指标: node_exporter_version
