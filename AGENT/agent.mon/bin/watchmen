#!/bin/bash

if [ "X$1" == "Xinstall" ];then
    echo '* * * * * root /opt/mydan/dan/agent.mon/bin/watchmen >/dev/null 2>&1' > /etc/cron.d/mydan_bootstrap_cron_watchmen
    echo install done.
    exit
fi

if [ "X$1" == "Xuninstall" ];then
    rm /etc/cron.d/mydan_bootstrap_cron_watchmen
    echo uninstall done.
    exit
fi

active=$(ps -ef|grep mydan.bootstrap.master|grep -v grep|wc -l)

if [ "X$active" == "X1" ];then
    echo mydan.bootstrap.master active
    exit
fi

killall mydan.node_exporter.65110
killall mydan.tcpserver.65111

if [ -f /opt/mydan/dan/bootstrap/exec/prometheus.node_exporter.9100 ];then
    lsof -i:9100|grep LISTEN|awk '{print $2}'|xargs -i{} kill {}
fi

/opt/mydan/dan/bootstrap/bin/bootstrap --start
