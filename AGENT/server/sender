#!/data/Software/mydan/perl/bin/perl -I/data/Software/mydan/AGENT/lib -I/data/Software/mydan/AGENT/private/lib
use strict;
use warnings;
use MYDB;
use FindBin qw( $RealBin );
use Data::Dumper;

use MYDan::Util::OptConf;
use Code;

=head1 SYNOPSIS

 $0

=cut

$0 = 'agent_server_sender';

$ENV{PATH} = "$ENV{PATH}:/data/Software/mydan/AGENT/pp:/data/Software/mydan/Connector/pp";

while(1)
{
    for my $file ( glob "/data/open-c3-data/monitor-sender/sender.*.wait" )
    {
        my $stat = 'succ';
        if ( system "c3_agent_pp_senderinfo $file|c3_agent_pp_senderadduser |c3_agent_pp_senderaddcont | c3_connector_pp_send" )
        {
            warn "monitor sender fail: $!";
            $stat = 'fail';
        }

         my $newfile = $file; $newfile =~ s/wait$/$stat/;
         rename $file, $newfile or die "rename fail: $!";
    }

    sleep 6;

}
