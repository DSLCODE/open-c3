#!/data/Software/mydan/perl/bin/perl -I/data/Software/mydan/CI/lib -I/data/Software/mydan/CI/private/lib
use strict;
use warnings;

binmode STDIN, ':utf8';
binmode STDOUT, ':utf8';
binmode STDERR, ':utf8';

$|++;

use MYDB;
use FindBin qw( $RealBin );

=head1 SYNOPSIS

 $0 user title content

=cut

my $db = MYDB->new( "$RealBin/../conf/conn" );

sub save
{
    my ( $user, $title, $content ) = @_;
    die "date err" unless $user && $title;
    $title =~ s/'/"/g;
    $content =~ s/'/"/g;
    eval{ $db->execute( "insert into openc3_connector_auditlog (`user`,`title`,`content`) values('$user','$title','$content')" ); };
    die if $@;
}

if( @ARGV )
{
    save( @ARGV );
}
else
{
    while(<STDIN>){ chomp; save(split /;/,$_, 3); }
}
