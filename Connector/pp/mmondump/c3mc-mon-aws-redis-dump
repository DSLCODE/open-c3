#!/data/Software/mydan/perl/bin/perl
use strict;
use warnings;

$|++;

=head1 SYNOPSIS

 $0

=cut

my @col = qw( 实例ID 名称 业务负责人 实例类型 );
my $col = join " ", @col;
my @x = `c3mc-device-data-get curr database aws-redis $col`;
chomp @x;

my @mon = qw( avg-cpu avg-mem );

my %mon;
for my $mon ( @mon )
{
    my @xx = `c3mc-mon-aws-redis-${mon}-dump`;
    chomp @xx;
    for ( @xx )
    {
        my ( $instance, $val ) = split /\t/, $_;
        $mon{$mon}{$instance} = $val;
    }
}

printf "%s\n", join "\t", @col, @mon;
for my $x ( @x )
{
    my ( $instance ) = split /\t/, $x;
    $instance =~ s/.*:cluster://;
    printf "%s\n", join "\t", $x, map{ $mon{$_} && defined $mon{$_}{$instance} ? $mon{$_}{$instance} : 'unkown' }@mon;
}
